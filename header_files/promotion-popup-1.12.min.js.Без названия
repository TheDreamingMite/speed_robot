"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();$(function(a){return function(){var b="p__p",c="p__v",d=864e5,e={chart:"chart_tab",technical:"technical_tab",register:"registration_process",portfolio:"add_to_portfolio","3_PV":"3_PV",add_alert:"add_alert","streaming-chart":"chart_tab"},f=window.ga||$.noop,g=1500,h=$(document.body),i=h.find(".js-promotion-popup"),j=h.find(".js-general-overlay"),k=i.find(".js-promotion-popup-close"),l=i.find(".js-dfp"),m=function(){function h(){var b=this;_classCallCheck(this,h);var c=this._readFromStorage()||{},d=c.impressionsCount,e=void 0===d?0:d,f=c.impressions;this.count=e,this.impressions=f,this.triggerSource="",this.loadedDfpSlot=null,k.on("click",function(){return b._closePopup()}),a.pageType.is(["chart","streaming-chart","technical"])?setTimeout(function(){return b.openPromotionPopup(a.pageType)},g):this._incrementPageViews()}return _createClass(h,[{key:"_incrementPageViews",value:function(){var a=Storage.get(c)||0;++a,Storage.set(c,a),a%3==0&&this.openPromotionPopup("3_PV")}},{key:"_handleGaEvent",value:function(a){f("allSitesTracker.send","event","Promotion Popup",a,this.triggerSource)}},{key:"_readFromStorage",value:function(){return Storage.get(b)}},{key:"_addDfpKeyValues",value:function(a,b){window.googletag.cmd.push(function(){window.googletag.pubads().setTargeting(a,b)})}},{key:"_checkImpressionsValidity",value:function(){return!this.impressions||this.impressions.length<12&&0===this._impressionsInLastXDays(1)&&this._impressionsInLastXDays(7)<2}},{key:"_closePopup",value:function(){var a=this;i._hide(),j._hide().off("click.promotion"),this.loadedDfpSlot&&setTimeout(function(){return window.googletag.destroySlots(a.loadedDfpSlot)},100)}},{key:"_bindClickOnBroker",value:function(){var a=this;l.find("iframe").contents().on("click",function(){a._handleGaEvent("Popup clicked"),a._closePopup()})}},{key:"_impressionsInLastXDays",value:function(a){var b=Date.now()-d*a;return this.impressions.filter(function(a){return a>b}).length}},{key:"saveToStorage",value:function(a,c){this.impressions||(this.impressions=[]),this.impressions.push(c),Storage.set(b,{impressionsCount:a,impressions:this.impressions})}},{key:"openPromotionPopup",value:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=this._checkImpressionsValidity();if(this.triggerSource=e[a],d||c){var f=l.data(),g=f.size,h=f.slotId,k=l.attr("id");this._addDfpKeyValues("promotion_trigger",this.triggerSource),this._addDfpKeyValues("promotion_count",""+this.count+1),$.initSlot(h,k,g,function(a){window.googletag.pubads().addEventListener("slotRenderEnded",function(c){d&&c.slot===a&&!c.isEmpty&&(d=!1,b.loadedDfpSlot=a,i.customFadeIn(500),j._show().on("click.promotion",function(){return b._closePopup()}),b._bindClickOnBroker(),b.saveToStorage(++b.count,Date.now()))})})}}}]),h}();window.b21040c7ad28=new m}}(window.siteData));/**|**/